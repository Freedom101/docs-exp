"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[40918],{85695:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var r=s(74848),a=s(28453);const o={},t="Restoring an Admin User",i={id:"setup-and-configure/advanced-workspace-management/restoring-an-admin-user",title:"Restoring an Admin User",description:"In the management of any digital platform, there may be instances where access to an admin user is lost and needs to be restored. Rocket.Chat provides a comprehensive process for restoring an admin user without requiring another admin user. This document will provide a detailed overview of how to restore an admin user in Rocket.Chat by accessing the database.",source:"@site/docs/setup-and-configure/advanced-workspace-management/restoring-an-admin-user.md",sourceDirName:"setup-and-configure/advanced-workspace-management",slug:"/setup-and-configure/advanced-workspace-management/restoring-an-admin-user",permalink:"/docs-exp/docs/setup-and-configure/advanced-workspace-management/restoring-an-admin-user",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/setup-and-configure/advanced-workspace-management/restoring-an-admin-user.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Google Translate Integration&#x20;",permalink:"/docs-exp/docs/setup-and-configure/advanced-workspace-management/google-translate-integration"},next:{title:"Troubleshooting",permalink:"/docs-exp/docs/setup-and-configure/advanced-workspace-management/troubleshooting"}},c={},d=[];function l(e){const n={admonition:"admonition",code:"code",em:"em",h1:"h1",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"restoring-an-admin-user",children:"Restoring an Admin User"}),"\n",(0,r.jsx)(n.p,{children:"In the management of any digital platform, there may be instances where access to an admin user is lost and needs to be restored. Rocket.Chat provides a comprehensive process for restoring an admin user without requiring another admin user. This document will provide a detailed overview of how to restore an admin user in Rocket.Chat by accessing the database."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Access the Database:"})," Restoring an admin user in Rocket.Chat involves accessing the database, which can be done in various ways depending on how the Rocket.Chat server was installed. Restoring an admin user in Rocket.Chat involves accessing the database, which can be done in various ways depending on how the Rocket.Chat server was installed. For Docker-based installations, the mongo shell within the mongo container can be accessed, and for Ubuntu Snaps installations, MongoDB can be connected directly."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Docker-based installations"}),":"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["To open the ",(0,r.jsx)(n.strong,{children:"mongo shell"})," within the ",(0,r.jsx)(n.strong,{children:"mongo container"}),","]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Change into the docker compose directory (where your ",(0,r.jsx)(n.code,{children:"docker-compose.yml"})," is located) and run mongo bash."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd /opt/docker/Rocket.Chat\ndocker compose run mongo bash\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Alternatively, you can run the following command without navigating to the",(0,r.jsx)(n.code,{children:"docker-compose.yml"})," directory."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"docker exec -it -u root mongo-image /bin/bash\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Login into the mongo shell."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"mongo\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Make sure to replace ",(0,r.jsx)(n.code,{children:"mongo"})," with the name of your MongoDB container if you use a different one."]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Open the database in the mongo shell"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"use rocketchat\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Make sure to replace ",(0,r.jsx)(n.code,{children:"rocketchat"})," with the name of your Mongo database. If you're unsure of the name, you can either check your ",(0,r.jsx)(n.code,{children:"docker-compose.yml"})," file or run the following command:"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"show dbs\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Ubuntu Snaps Installation"}),":"]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Connect to MongoDB using the following command:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"sudo rocketchat-server.mongo\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Select the Rocket.Chat Database."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"use parties\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Updating the Admin Password"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"To update the admin password, you can either use a one-time access token or update the admin password to a random string."}),"\n",(0,r.jsx)(n.p,{children:"Using an access token will require the user to change their password."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'db.getCollection(\'users\').update({username:"administrator"}, {$set: { "services":{"loginToken":{"token":"some-token-id-that-you-will-use-to-login-once"}}, "requirePasswordChange":true} })\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Then access ",(0,r.jsx)(n.code,{children:"http://{your server url}/login-token/some-token-id-that-you-will-use-to-login-once"})," to log in."]}),"\n",(0,r.jsxs)(n.p,{children:["Alternatively, you can update the admin password to a random string. Using ",(0,r.jsx)(n.code,{children:"12345"})," as an example of the password, use its hashed(bycrypt) value:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'db.getCollection(\'users\').update({username:"administrator"}, { $set: {"services" : { "password" : {"bcrypt" : "$2a$10$n9CM8OgInDlwpvjLKLPML.eizXIzLlRtgCh3GRLafOdR9ldAUh/KG" } } } })\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["Replace ",(0,r.jsx)(n.code,{children:"administrator"})," with the appropriate username of the administrator on your server."]})})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Restart your application container in case the new password is not accepted yet."}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Generate a Valid Admin Password:"})," To generate a valid password and its hashed value with ",(0,r.jsx)(n.code,{children:"bcrypt-cli,"})]}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Install ",(0,r.jsx)(n.code,{children:"bcrypt-cli"})," with:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"// npm install -g @carsondarling/bcrypt-cli\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Then, use this to generate your ",(0,r.jsx)(n.code,{children:"bcrypt"})," password:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'// npm install -g @carsondarling/bcrypt-cli bcrypt $(echo -n "yourPasswordHere" | sha256sum | cut -d " " -f 1) && echo\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reset a User role to Admin"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"In addition to updating the password, the user role can also be reset to admin using a specific database command. This ensures that the restored user has the necessary admin privileges."}),"\n",(0,r.jsx)(n.p,{children:"Run the following database command :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'db.users.update({username: "administrator"}, { $push: { roles: "admin"}})\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["Replace ",(0,r.jsx)(n.code,{children:"administrator"})," with the appropriate username of the administrator on your server."]})})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>i});var r=s(96540);const a={},o=r.createContext(a);function t(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);