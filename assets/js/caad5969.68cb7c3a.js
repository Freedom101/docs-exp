"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[80376],{29921:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var o=t(85893),s=t(11151);const r={},i="Keycloak",c={id:"use-rocket.chat/authentication/openid-connect/keycloak",title:"Keycloak",description:"Keycloak is an open-source identity and access management software. It supports user federation, OAuth, SAML, and OpenID Connect protocols. Along with role-based authorization, you can also connect to existing LDAP user directories. Rocket.Chat supports Keycloak configuration for you to securely manage your users and resources.",source:"@site/docs/use-rocket.chat/authentication/openid-connect/keycloak.md",sourceDirName:"use-rocket.chat/authentication/openid-connect",slug:"/use-rocket.chat/authentication/openid-connect/keycloak",permalink:"/docs-exp/docs/use-rocket.chat/authentication/openid-connect/keycloak",draft:!1,unlisted:!1,editUrl:"https://github.com/Freedom101/docs-exp/tree/main/my-website/docs/use-rocket.chat/authentication/openid-connect/keycloak.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"OpenID Connect",permalink:"/docs-exp/docs/use-rocket.chat/authentication/openid-connect/"},next:{title:"Okta Identity Cloud Service",permalink:"/docs-exp/docs/use-rocket.chat/authentication/openid-connect/okta-identity-cloud-service"}},l={},d=[{value:"Configure Keycloak OpenID Connect",id:"configure-keycloak-openid-connect",level:2},{value:"Configure Keycloak in Rocket.Chat",id:"configure-keycloak-in-rocketchat",level:2},{value:"Mapping non-federated Keycloak user roles to Rocket.Chat roles",id:"mapping-non-federated-keycloak-user-roles-to-rocketchat-roles",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"keycloak",children:"Keycloak"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://www.keycloak.org/",children:"Keycloak"})," is an open-source identity and access management software. It supports user federation, OAuth, SAML, and OpenID Connect protocols. Along with role-based authorization, you can also connect to existing LDAP user directories. Rocket.Chat supports Keycloak configuration for you to securely manage your users and resources."]}),"\n",(0,o.jsx)(n.p,{children:"This guide walks you through a basic Keycloak OpenID Connect setup in Rocket.Chat to log in with Keycloak credentials."}),"\n",(0,o.jsx)(n.h2,{id:"configure-keycloak-openid-connect",children:"Configure Keycloak OpenID Connect"}),"\n",(0,o.jsx)(n.p,{children:"To create a client in Keycloak, follow these steps:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Enter a ",(0,o.jsx)(n.strong,{children:"Client ID"}),", for example, ",(0,o.jsx)(n.code,{children:"rocket-chat-client"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Select the ",(0,o.jsx)(n.strong,{children:"Client Protocol"})," as ",(0,o.jsx)(n.code,{children:"openid-connect"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Select the ",(0,o.jsx)(n.strong,{children:"Access Type"})," as ",(0,o.jsx)(n.strong,{children:"confidential"}),". Setting the client as confidential means that a client secret is required to initial the login."]}),"\n",(0,o.jsxs)(n.li,{children:["Enable the ",(0,o.jsx)(n.strong,{children:"Standard Flow Enabled"})," field."]}),"\n",(0,o.jsxs)(n.li,{children:["Enter the ",(0,o.jsx)(n.strong,{children:"Valid Redirect URIs"}),", for example, ",(0,o.jsx)(n.code,{children:"https://{demo.rocket.cat}/*"})]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Save the client. A new credentials tab will be created for the client. This credentials tab will provide the client secret to be used when configuring Keycloak in your Rocket.Chat workspace."}),"\n",(0,o.jsx)(n.h2,{id:"configure-keycloak-in-rocketchat",children:"Configure Keycloak in Rocket.Chat"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Login to Rocket.Chat with an administrator account and navigate to the ",(0,o.jsx)(n.strong,{children:"OAuth"})," page in the ",(0,o.jsx)(n.strong,{children:"Settings"})," tab."]}),"\n",(0,o.jsxs)(n.li,{children:["Click the ",(0,o.jsx)(n.strong,{children:"Add custom OAuth"})," button and enter the following details:"]}),"\n"]}),"\n",(0,o.jsxs)("table",{children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{width:"189",children:"Field"}),(0,o.jsx)("th",{width:"292",children:"Description"}),(0,o.jsx)("th",{children:"Example"})]})}),(0,o.jsxs)("tbody",{children:[(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:"URL"})}),(0,o.jsx)("td",{children:"The URL of the OpenID Connect issuer in the Keycloak realm."}),(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:(0,o.jsx)(n.a,{href:"https://keycloak.support.rocket.cat/realms/%7Brealm-name%7D/protocol",children:"https://keycloak.support.rocket.cat/realms/{realm-name}/protocol"})})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:"Token Path"})}),(0,o.jsx)("td",{children:"The token endpoint is used to obtain access tokens. Enter the path from the token endpoint."}),(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:"/openid-connect/token"})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:"Token sent via"})}),(0,o.jsxs)("td",{children:["Select whether the token is sent via ",(0,o.jsx)("code",{children:"Header"})," or ",(0,o.jsx)("code",{children:"Payload"}),"."]}),(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:"Header"})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:"Identity Token Sent Via"})}),(0,o.jsxs)("td",{children:["Select whether the identity token is sent via ",(0,o.jsx)("code",{children:"Header"}),", ",(0,o.jsx)("code",{children:"Payload"}),", or the same method as the ",(0,o.jsx)("code",{children:"Token sent via"})," field."]}),(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:"Token sent via"})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:"Identity Path"})}),(0,o.jsx)("td",{children:"The user information endpoint is used to retrieve user data. Enter the path from the user endpoint."}),(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:"/openid-connect/userinfo"})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:"Authorize Path"})}),(0,o.jsx)("td",{children:"Enter the path from the authorization endpoint."}),(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:"/openid-connect/auth"})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:"Scope"})}),(0,o.jsx)("td",{children:"The scope defines the user access level and permissions that you have configured in Keycloak."}),(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:"openid"})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:"Param Name for access token"})}),(0,o.jsx)("td",{children:"The name of the access token."}),(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:"access_token"})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:"Id"})}),(0,o.jsx)("td",{children:"The client ID that you created in Keycloak."}),(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:"rocket-chat-client"})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:"Secret"})}),(0,o.jsxs)("td",{children:["Enter the client secret from your Keycloak client's ",(0,o.jsx)("strong",{children:"Credentials"})," tab."]}),(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:"QTrbVadjfjhurUzsJHRbteQPHHm8Od6w"})})]}),(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:(0,o.jsx)("strong",{children:"Button Text"})}),(0,o.jsx)("td",{children:"Enter the text to be displayed on the login screen."}),(0,o.jsx)("td",{children:(0,o.jsx)("code",{children:"Login with Keycloak"})})]})]})]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["To access the URL paths provided in the configurations, go to ",(0,o.jsx)(n.strong,{children:"Realm Settings > General"})," and click the endpoints link. While configuring the settings, replace ",(0,o.jsx)(n.code,{children:"realm_name"})," with the appropriate realm name. The default realm provided by Keycloak is ",(0,o.jsx)(n.code,{children:"master"}),"."]})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsxs)(n.li,{children:["You can leave the rest of the configurations as default. Click ",(0,o.jsx)(n.strong,{children:"Save changes."})]}),"\n",(0,o.jsxs)(n.li,{children:["Enable the new Keycloak provider. Click ",(0,o.jsx)(n.strong,{children:"Refresh OAuth Services"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["If you are in a test environment with no SMTP server set, disable two-factor authentication in ",(0,o.jsx)(n.strong,{children:"Administration > Settings > General"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["A ",(0,o.jsx)(n.strong,{children:"Login with Keycloak"})," button is displayed on your workspace's login page. Users can now log in with their Keycloak credentials!"]}),"\n",(0,o.jsx)(n.h2,{id:"mapping-non-federated-keycloak-user-roles-to-rocketchat-roles",children:"Mapping non-federated Keycloak user roles to Rocket.Chat roles"}),"\n",(0,o.jsxs)(n.p,{children:["Client-specific roles of a Keycloak-managed user can be mapped to Rocket.Chat roles. This does not work for federated users (LDAP-managed users). For this example, to map the ",(0,o.jsx)(n.code,{children:"admin"})," and ",(0,o.jsx)(n.code,{children:"livechat-manager"})," ",(0,o.jsx)(n.a,{href:"../../workspace-administration/permissions/#roles",children:"role"}),", add the required roles to the client."]}),"\n",(0,o.jsx)(n.p,{children:"To create a role in Keycloak, follow these steps:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Navigate to ",(0,o.jsx)(n.strong,{children:"Roles"})," and click ",(0,o.jsx)(n.strong,{children:"Add Role."})]}),"\n",(0,o.jsxs)(n.li,{children:["Fill in the name and description of the role, and then click ",(0,o.jsx)(n.strong,{children:"Save"}),"."]}),"\n",(0,o.jsx)(n.li,{children:"Add a mapper entry that maps our client roles to OpenID, passing the value to Rocket.Chat."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["To view all the client roles you have created, navigate to ",(0,o.jsx)(n.strong,{children:"Roles"})," and click ",(0,o.jsx)(n.strong,{children:"View all roles"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["You can also create composite roles. A composite role is a role that can be associated with other roles. To define composite roles, navigate to ",(0,o.jsx)(n.strong,{children:"Roles > Composite Roles"}),". To grant the Rocket.Chat role to a user, we have to modify the user's ",(0,o.jsx)(n.strong,{children:"Role Mappings"}),"."]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["For more information on Keycloak server setup and roles, see ",(0,o.jsx)(n.a,{href:"https://www.keycloak.org/docs/latest/server_admin/#keycloak-features-and-concepts",children:"Server Administration Guide"}),"."]})})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>c,a:()=>i});var o=t(67294);const s={},r=o.createContext(s);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);