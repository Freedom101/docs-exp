"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[241],{66798:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var i=t(85893),o=t(11151);const r={},a="Running in a sub folder with Apache",s={id:"setup-and-configure/environment-configuration/additional-configurations/running-in-a-sub-folder-with-apache",title:"Running in a sub folder with Apache",description:"NOTE: Running in a subfolder has been officially deprecated. It will no longer be supported in the upcoming 4.0 release. See our April 2020 announcement",source:"@site/docs/setup-and-configure/environment-configuration/additional-configurations/running-in-a-sub-folder-with-apache.md",sourceDirName:"setup-and-configure/environment-configuration/additional-configurations",slug:"/setup-and-configure/environment-configuration/additional-configurations/running-in-a-sub-folder-with-apache",permalink:"/docs-exp/docs/setup-and-configure/environment-configuration/additional-configurations/running-in-a-sub-folder-with-apache",draft:!1,unlisted:!1,editUrl:"https://github.com/Freedom101/docs-exp/tree/main/my-website/docs/setup-and-configure/environment-configuration/additional-configurations/running-in-a-sub-folder-with-apache.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Extras",permalink:"/docs-exp/docs/setup-and-configure/environment-configuration/additional-configurations/"},next:{title:"Setting Up Client SSL Certificate Authentication for Rocket.Chat",permalink:"/docs-exp/docs/setup-and-configure/environment-configuration/additional-configurations/setting-up-client-ssl-certificate-authentication-for-rocket.chat"}},c={},d=[{value:"Running the application",id:"running-the-application",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"running-in-a-sub-folder-with-apache",children:"Running in a sub folder with Apache"}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"NOTE"}),": Running in a subfolder has been officially deprecated. It will no longer be supported in the upcoming 4.0 release. See our ",(0,i.jsx)(n.a,{href:"https://forums.rocket.chat/t/support-for-installation-in-subdirectory-will-be-discontinued/6371",children:"April 2020 announcement"})]})}),"\n",(0,i.jsxs)(n.p,{children:["If you want to run your server in a subfolder like ",(0,i.jsx)(n.code,{children:"https://your.domain.com/chat/"})," you have to set up a reverse proxy. See ",(0,i.jsx)(n.a,{href:"/docs-exp/docs/setup-and-configure/environment-configuration/configuring-ssl-reverse-proxy",children:"Run Rocket.Chat behind a SSL Reverse Proxy"})]}),"\n",(0,i.jsxs)(n.p,{children:["If you are using apache you will have to tweak the configuration. First you have to put the ",(0,i.jsx)(n.code,{children:"Rewrite/Proxy"})," into a ",(0,i.jsx)(n.code,{children:"Location-tag"}),'. For example, if you want to provide the service under the "chat" subfolder, your config should look like this:']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-apacheconf",children:"<Location /chat>\n    Order allow,deny\n    Allow from all\n\n    RewriteEngine On\n    RewriteCond %{HTTP:Upgrade} =websocket [NC]\n    RewriteRule /var/www/(.*)           ws://localhost:3000/$1 [P,L]\n    RewriteCond %{HTTP:Upgrade} !=websocket [NC]\n    RewriteRule /var/www/(.*)           http://localhost:3000/$1 [P,L]\n\n    ProxyPassReverse http://localhost:3000\n</Location>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The main difference to the standard reverse proxy configuration is an additional RewriteRule, ",(0,i.jsx)(n.code,{children:"/var/www"})," in the example, which must be changed to your DocumentRoot (if it's not already your DocumentRoot)."]}),"\n",(0,i.jsxs)(n.p,{children:["If you pass the whole path, including the DocumentRoot to the Rocket.Chat server, you'll get a 404 response and an ",(0,i.jsx)(n.code,{children:"Unknown path"})," server error."]}),"\n",(0,i.jsxs)(n.p,{children:["In our example, we used the ",(0,i.jsx)(n.code,{children:"/chat"})," as a subfolder (it's parsed out of the ",(0,i.jsx)(n.code,{children:"ROOT_URL"})," provided) but the Rocket.Chat server gets a request for ",(0,i.jsx)(n.code,{children:"/var/www/chat"}),", detects a mismatch and returns the above-mentioned error."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Additional notes:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Using the RewriteBase Directive won't work."}),"\n",(0,i.jsxs)(n.li,{children:["The ProxyPassReverse can be used inside a ",(0,i.jsx)(n.code,{children:"Location"})," tag and the first parameter must be omitted in this case."]}),"\n",(0,i.jsxs)(n.li,{children:["You don't need to configure a Location for the root folder ",(0,i.jsx)(n.code,{children:"/"})," when using Rocket.Chat in a subfolder (it's likely configured for other stuff already in this case)."]}),"\n",(0,i.jsxs)(n.li,{children:["For those curious about the details: the mentioned path-handling is in ",(0,i.jsx)(n.code,{children:"webapp.js"}),", search for ",(0,i.jsx)(n.code,{children:"Unknown path"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Please make sure that the modules ",(0,i.jsx)(n.code,{children:"rewrite"}),", ",(0,i.jsx)(n.code,{children:"proxy_http"})," and ",(0,i.jsx)(n.code,{children:"proxy_wstunnel"})," are enabled in the apache configuration. Otherwise, the WebSocket calls will return a 500 http response."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"running-the-application",children:"Running the application"}),"\n",(0,i.jsxs)(n.p,{children:["To run in a subfolder you should pass the environment variable ",(0,i.jsx)(n.code,{children:"ROOT_URL"})," to the process. For example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ROOT_URL=https://your.domain.com/chat/ node main.js\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you followed the manual installation guide, you may already have configured (and persisted) this environment variable - in this case, you can ignore this advice."})]})}function u(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>a});var i=t(67294);const o={},r=i.createContext(o);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);