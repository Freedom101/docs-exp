"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[37820],{29578:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>l});var i=t(74848),s=t(28453);const o={},r="Simple Telegram Bot",a={id:"use-rocket.chat/workspace-administration/integrations/simple-telegram-bot",title:"Simple Telegram Bot",description:"A simple relay communication between Rocket.Chat and Telegram is possible by configuring a basic bot. The guide below shows a community example of how this can be achieved with webhooks.",source:"@site/docs/use-rocket.chat/workspace-administration/integrations/simple-telegram-bot.md",sourceDirName:"use-rocket.chat/workspace-administration/integrations",slug:"/use-rocket.chat/workspace-administration/integrations/simple-telegram-bot",permalink:"/docs-exp/docs/use-rocket.chat/workspace-administration/integrations/simple-telegram-bot",draft:!1,unlisted:!1,editUrl:"https://github.com/Freedom101/docs-exp/tree/main/my-website/docs/use-rocket.chat/workspace-administration/integrations/simple-telegram-bot.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Sentry",permalink:"/docs-exp/docs/use-rocket.chat/workspace-administration/integrations/sentry"},next:{title:"TravisCI",permalink:"/docs-exp/docs/use-rocket.chat/workspace-administration/integrations/travis-ci"}},c={},l=[{value:"Getting Started",id:"getting-started",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Creating an Incoming Telegram webhook in Rocket.Chat",id:"creating-an-incoming-telegram-webhook-in-rocketchat",level:3},{value:"Setting Telegram webhook",id:"setting-telegram-webhook",level:4},{value:"Test Telegram Incoming Integration",id:"test-telegram-incoming-integration",level:4},{value:"Creating a Telegram Group with Bot access",id:"creating-a-telegram-group-with-bot-access",level:3},{value:"Creating an Outgoing Telegram webhook in Rocket.Chat",id:"creating-an-outgoing-telegram-webhook-in-rocketchat",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"simple-telegram-bot",children:"Simple Telegram Bot"}),"\n",(0,i.jsx)(n.p,{children:"A simple relay communication between Rocket.Chat and Telegram is possible by configuring a basic bot. The guide below shows a community example of how this can be achieved with webhooks."}),"\n",(0,i.jsx)(n.p,{children:"This gives you the possibility of relaying messages between Telegram and Rocket.Chat in a specified room of your choice."}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["This integration is not suitable for Omnichannel Conversations. Consult the ",(0,i.jsx)(n.a,{href:"../../../extend-rocket.chat-capabilities/rocket.chat-marketplace/rocket.chat-public-apps-guides/omnichannel-apps/telegram-app/",title:"mention",children:"telegram-app"})," for managing your Omnichannel conversations with Telegram. Workspaces subscribed to any of Rocket.Chat's ",(0,i.jsx)(n.a,{href:"/docs-exp/docs/readme/our-plans",children:"premium plans"})," can install the ",(0,i.jsx)(n.a,{href:"../../../extend-rocket.chat-capabilities/rocket.chat-marketplace/rocket.chat-public-apps-guides/omnichannel-apps/telegram-app/",children:"Telegram App"}),", which comes with additional functionalities and Omnichannel features."]})}),"\n",(0,i.jsx)(n.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Make sure Your Rocket.Chat workspace URL is publicly available."})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Log in to your ",(0,i.jsx)(n.a,{href:"https://web.telegram.org/",children:"Telegram"})," account on your mobile or using a browser."]}),"\n",(0,i.jsxs)(n.li,{children:["Add and open a conversation with the user ",(0,i.jsx)(n.a,{href:"https://t.me/botfather",children:(0,i.jsx)(n.code,{children:"BotFather"})}),(0,i.jsx)(n.code,{children:"."})]}),"\n",(0,i.jsxs)(n.li,{children:["Click ",(0,i.jsx)(n.strong,{children:"start."})]}),"\n",(0,i.jsxs)(n.li,{children:["Send ",(0,i.jsx)(n.code,{children:"/newbot"})," to start creating a new bot."]}),"\n",(0,i.jsxs)(n.li,{children:["Follow the instructions to continue.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Set the bot's username. Telegram successfully creates the bot and shows how to access it."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Copy the token provided, it is needed for the configuration."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"Before configuring the Telegram integration, make sure you:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs-exp/docs/use-rocket.chat/user-guides/rooms/channels/create-a-new-channel",children:"Create a channel"})," on Rocket.Chat for incoming and outgoing conversations."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../users/#add-new-users",children:"Create a user"})," with ",(0,i.jsx)(n.code,{children:"bot the"})," ",(0,i.jsx)(n.a,{href:"https://github.com/RocketChat/docs/blob/master/setup-and-administer-rocket.chat/roles-in-rocket.chat",children:"role "}),"to be used for the relay."]}),"\n"]})]}),"\n",(0,i.jsx)(n.h3,{id:"creating-an-incoming-telegram-webhook-in-rocketchat",children:"Creating an Incoming Telegram webhook in Rocket.Chat"}),"\n",(0,i.jsxs)(n.p,{children:["The incoming webhook is responsible for relaying messages from Telegram into Rocket.Chat into a specific ",(0,i.jsx)(n.a,{href:"../../user-guides/rooms/channels/",children:"Channel"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"To create an incoming webhook:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to ",(0,i.jsx)(n.strong,{children:"Administration"})," > ",(0,i.jsx)(n.strong,{children:"Workspace"})," > ",(0,i.jsx)(n.strong,{children:"Integrations"})," in Rocket.Chat"]}),"\n",(0,i.jsxs)(n.li,{children:["Create a new Incoming Webhook following the guide ",(0,i.jsx)(n.a,{href:"./#create-a-new-incoming-webhook",title:"mention",children:"#create-a-new-incoming-webhook"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Enable the integration"}),"\n",(0,i.jsx)(n.li,{children:"Set the webhook integration name."}),"\n",(0,i.jsxs)(n.li,{children:["Set the ",(0,i.jsx)(n.strong,{children:"Post to Channel"})," as the channel created above."]}),"\n",(0,i.jsxs)(n.li,{children:["Set ",(0,i.jsx)(n.strong,{children:"Post as"}),", as the user created above."]}),"\n",(0,i.jsx)(n.li,{children:"Enable the script and paste the following code."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"class Script {\n    addQuotePrefix(str) {\n        let tmp = str.split('\\n'),\n            res = [];\n\n        for (const frag of tmp) {\n            res.push(`> ${frag}`);\n        }\n\n        return res.join('\\n');\n    }\n\n    process_incoming_request({ request }) {\n        // UNCOMMENT THE BELOW LINE TO DEBUG IF NEEDED.\n        // console.log(request.content);\n        if ('edited_message' in request.content) {\n            request.content.message = request.content.edited_message;\n        }\n        let from = request.content.message.from;\n        let who = from.username\n        let icon_url = '/avatar/' + from.username + '.jpg'\n        if(!who)  {\n          if (from.first_name && from.last_name) {\n            who = `${from.first_name} ${from.last_name}`\n          } else if (from.first_name) {\n            who = from.first_name\n          } else {\n            who = from.last_name\n          }\n          icon_url = `/avatar/${request.content.message.from.first_name}.jpg`\n        }\n        let body = request.content.message.text\n\n        if(!body) {\n          if(request.content.message.hasOwnProperty(\"sticker\") && request.content.message.sticker.emoji) {\n            // It's a sticker\n            body = request.content.message.sticker.emoji\n        } else {\n           return {}\n          }\n        }\n\n        if(request.content.message.reply_to_message) {\n              var quotedMessage = \n                \"*\" +\n                request.content.message.reply_to_message.from.username +\n                \"*\\n\" +\n                request.content.message.reply_to_message.text;\n\n              quotedMessage = this.addQuotePrefix(quotedMessage);\n            body = quotedMessage + '\\n' + body;\n        }\n\n        return {\n            content: {\n                username: who,\n                icon_url: icon_url,\n                text: body\n            }\n        };\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Save the integration."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This creates a new incoming integration with a ",(0,i.jsx)(n.strong,{children:"webhook URL"})," and ",(0,i.jsx)(n.strong,{children:"token"})," provided."]}),"\n",(0,i.jsx)(n.h4,{id:"setting-telegram-webhook",children:"Setting Telegram webhook"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Copy the incoming webhook URL provided by Rocket.Chat after saving."}),"\n",(0,i.jsxs)(n.li,{children:["Change the following URL with ",(0,i.jsx)(n.code,{children:"yourTelegramBotToken"})," and Incoming ",(0,i.jsx)(n.code,{children:"webhookURL"})," and open it on your browser."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:"https://api.telegram.org/bot<my-telegram-authorization-token>/setwebhook?url=<Incoming_Webhook_Link_from_Rocket.Chat>\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"A response indicating success is sent which looks like this:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n"ok": true,\n"result": true,\n"description": "Webhook was set"\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"test-telegram-incoming-integration",children:"Test Telegram Incoming Integration"}),"\n",(0,i.jsx)(n.p,{children:"Test your incoming Webhook by sending a telegram message to the Telegram bot."}),"\n",(0,i.jsxs)(n.p,{children:["The message sent gets posted in ",(0,i.jsx)(n.code,{children:"channel"})," by the ",(0,i.jsx)(n.code,{children:"user"}),"you specified in the incoming webhook configuration page."]}),"\n",(0,i.jsx)(n.h3,{id:"creating-a-telegram-group-with-bot-access",children:"Creating a Telegram Group with Bot access"}),"\n",(0,i.jsx)(n.p,{children:"A Telegram group can be configured to send and receive messages to and from Rocket.Chat."}),"\n",(0,i.jsx)(n.p,{children:"Create a Telegram group and grant bot access."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create a new Telegram group."}),"\n",(0,i.jsxs)(n.li,{children:["Get the group chat id. This can be gotten by:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Adding the user ",(0,i.jsx)(n.code,{children:"RawDataBot"}),"to the group"]}),"\n",(0,i.jsx)(n.li,{children:"On joining, a response like below is seen with the chat id"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Your chat id is -873457731, your id is 1140377161\n\nAlso you can send me username or joinchat link in a private message\n\nKisses, your bot\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Change the bot group privacy settings so it can listen to all messages by:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Sending the message ",(0,i.jsx)(n.code,{children:"/setprivacy"})," to ",(0,i.jsx)(n.a,{href:"https://t.me/botfather",children:"BotFather"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Choosing the bot you want to edit."}),"\n",(0,i.jsxs)(n.li,{children:["Setting the status to ",(0,i.jsx)(n.code,{children:"Disable."})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-an-outgoing-telegram-webhook-in-rocketchat",children:"Creating an Outgoing Telegram webhook in Rocket.Chat"}),"\n",(0,i.jsx)(n.p,{children:"The outgoing integration is used to relay messages back from Rocket.Chat to Telegram."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Go to ",(0,i.jsx)(n.strong,{children:"Administration"})," > ",(0,i.jsx)(n.strong,{children:"Workspace"})," > ",(0,i.jsx)(n.strong,{children:"Integrations"})," in Rocket.Chat."]}),"\n",(0,i.jsxs)(n.li,{children:["Create an outgoing webhook following this guide ",(0,i.jsx)(n.a,{href:"./#create-a-new-outgoing-webhook",title:"mention",children:"#create-a-new-outgoing-webhook"}),".","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Select the Message sent as the ",(0,i.jsx)(n.strong,{children:"Event Trigger."})]}),"\n",(0,i.jsx)(n.li,{children:"Enable the integration."}),"\n",(0,i.jsx)(n.li,{children:"Set any Trigger Words which messages must have before they get relayed if needed."}),"\n",(0,i.jsx)(n.li,{children:"Specify the channel to listen to."}),"\n",(0,i.jsx)(n.li,{children:"Set the URL following this format:"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:"https://api.telegram.org/bot<my-telegram-authorization-token>/sendMessage?chat_id=<chat-id>\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Enable Script and paste the following code"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:"class Script {\n    prepare_outgoing_request({ request }) {\n        if (request.data.bot) {\n            //Don't repost messages from the bot.\n            return { };\n        } else {\n            return {\n                url: request.url + '&parse_mode=HTML' + '&text=' + encodeURIComponent('<b>' + request.data.user_name+ '</b>: ' + request.data.text),\n                method: 'GET'\n            };\n        }\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Save the integration."}),"\n",(0,i.jsx)(n.li,{children:"Add your bot to the telegram group and enjoy cross-platform communication between Rocket.Chat and Telegram."}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Multiple Outgoing Triggers can be configured to cover all use cases."}),"\n",(0,i.jsxs)(n.li,{children:["The scripts can be customized as needed. Learn more here ",(0,i.jsx)(n.a,{href:"./#script-details",title:"mention",children:"#script-details"})]}),"\n"]})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);