"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[89637],{79971:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>h});var t=i(74848),c=i(28453);const s={},o="Configure with an active PBX server",r={id:"use-rocket.chat/rocket.chat-voice-channel/voice-channel-admin-guide/configure-with-an-active-pbx-server/README",title:"Configure with an active PBX server",description:"If you have:",source:"@site/docs/use-rocket.chat/rocket.chat-voice-channel/voice-channel-admin-guide/configure-with-an-active-pbx-server/README.md",sourceDirName:"use-rocket.chat/rocket.chat-voice-channel/voice-channel-admin-guide/configure-with-an-active-pbx-server",slug:"/use-rocket.chat/rocket.chat-voice-channel/voice-channel-admin-guide/configure-with-an-active-pbx-server/",permalink:"/docs-exp/docs/use-rocket.chat/rocket.chat-voice-channel/voice-channel-admin-guide/configure-with-an-active-pbx-server/",draft:!1,unlisted:!1,editUrl:"https://github.com/Freedom101/docs-exp/tree/main/my-website/docs/use-rocket.chat/rocket.chat-voice-channel/voice-channel-admin-guide/configure-with-an-active-pbx-server/README.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Voice Channel Admin Guide",permalink:"/docs-exp/docs/use-rocket.chat/rocket.chat-voice-channel/voice-channel-admin-guide/"},next:{title:"Associate agents with extensions in Rocket.Chat",permalink:"/docs-exp/docs/use-rocket.chat/rocket.chat-voice-channel/voice-channel-admin-guide/configure-with-an-active-pbx-server/associate-agents-with-extensions-in-rocket.chat"}},a={},h=[{value:"1. Enable Voice Channel",id:"1-enable-voice-channel",level:3},{value:"2. Configure AMI connection",id:"2-configure-ami-connection",level:3},{value:"2.1 Test AMI Connection ",id:"21-test-ami-connection-",level:3},{value:"3. Configure WebSocket Server Connection",id:"3-configure-websocket-server-connection",level:2},{value:"3.1 Test WebSocket Connection ",id:"31-test-websocket-connection-",level:3}];function l(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"configure-with-an-active-pbx-server",children:"Configure with an active PBX server"}),"\n",(0,t.jsx)(n.p,{children:"If you have:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["An active ",(0,t.jsx)(n.a,{href:"../configure-without-previously-having-a-pbx-server/",children:"PBX server"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs-exp/docs/use-rocket.chat/rocket.chat-voice-channel/voice-channel-admin-guide/configure-without-previously-having-a-pbx-server/sip-extensions",children:"SIP extensions"})," created"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs-exp/docs/use-rocket.chat/rocket.chat-voice-channel/voice-channel-admin-guide/configure-without-previously-having-a-pbx-server/configure-asterisk-manager-interface-and-users",children:"Asterisk manager"})," configured"]}),"\n",(0,t.jsxs)(n.li,{children:["And ",(0,t.jsx)(n.a,{href:"../../../omnichannel/#enable-omnichannel",children:"Omnichannel activated"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"You can start to configure the voice channel Rocket.Chat workspace."}),"\n",(0,t.jsx)(n.h3,{id:"1-enable-voice-channel",children:"1. Enable Voice Channel"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Navigate to ",(0,t.jsx)(n.strong,{children:"Administration"})," > ",(0,t.jsx)(n.strong,{children:"Workspace"})," > ",(0,t.jsx)(n.strong,{children:"Settings"})," > ",(0,t.jsx)(n.strong,{children:"Voice Channel"})]}),"\n",(0,t.jsx)(n.li,{children:"Enable voice channel, as shown below:"}),"\n"]}),"\n",(0,t.jsxs)("figure",{children:[(0,t.jsx)("img",{src:"/img/image (820).png",alt:""}),(0,t.jsx)("figcaption",{children:(0,t.jsx)("p",{children:"Voice channel"})})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Rocket.Chat establishes two connections with Asterisk, one via AMI to read configuration and list extensions, queues, and some other things, and the second one is the WebRTC SIP registration."})}),"\n",(0,t.jsx)(n.h3,{id:"2-configure-ami-connection",children:"2. Configure AMI connection"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Navigate to ",(0,t.jsx)(n.strong,{children:"Administration > Workspace > Settings > Voice Channel > Settings > Asterisk Manager Interface (AMI)."})]}),"\n",(0,t.jsxs)(n.li,{children:["Fill the form with the FQDN of your server and the username/password gotten as shown ",(0,t.jsx)(n.a,{href:"../configure-without-previously-having-a-pbx-server/",children:"here"}),", or it should be provided to you by your ",(0,t.jsx)(n.em,{children:"Asterisk manager."})]}),"\n"]}),"\n",(0,t.jsxs)("figure",{children:[(0,t.jsx)("img",{src:"/img/image (1114).png",alt:""}),(0,t.jsx)("figcaption",{children:(0,t.jsx)("p",{children:(0,t.jsx)("em",{children:"AMI connection"})})})]}),"\n",(0,t.jsx)(n.h3,{id:"21-test-ami-connection-",children:"2.1 Test AMI Connection "}),"\n",(0,t.jsxs)(n.p,{children:["To test AMI connection, turn to the ",(0,t.jsx)(n.strong,{children:"Extensions"})," tab. Here you should see a list of the existing extensions in Asterisk:"]}),"\n",(0,t.jsxs)("figure",{children:[(0,t.jsx)("img",{src:"/img/image (101).png",alt:""}),(0,t.jsx)("figcaption",{children:(0,t.jsx)("p",{children:"Extensions"})})]}),"\n",(0,t.jsx)(n.p,{children:"Also enabling the AMI debug you may see connections coming and the RC AMI user connected:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tcl",children:"manager set debug on\nmanager show connected\n"})}),"\n",(0,t.jsxs)("figure",{children:[(0,t.jsx)("img",{src:"/img/image (206).png",alt:""}),(0,t.jsx)("figcaption",{children:(0,t.jsx)("p",{children:"Rocket.Chat connected to the Asterisk\u2019s AMI"})})]}),"\n",(0,t.jsx)(n.p,{children:"If you see it, your Rocket.Chat is connected to Asterisk\u2019s AMI."}),"\n",(0,t.jsx)(n.h2,{id:"3-configure-websocket-server-connection",children:"3. Configure WebSocket Server Connection"}),"\n",(0,t.jsx)(n.p,{children:"Rocket.Chat needs a WebSocket connection to forward calls from Asterisk to Rocket.Chat."}),"\n",(0,t.jsx)(n.p,{children:"The parameters for a FreePBX connection are:"}),"\n",(0,t.jsxs)("figure",{children:[(0,t.jsx)("img",{src:"/img/image (674).png",alt:""}),(0,t.jsx)("figcaption",{children:(0,t.jsx)("p",{children:"Websocket connection"})})]}),"\n",(0,t.jsx)(n.p,{children:"Change them according to your Asterisk server conditions. Then in the Settings tab, assign at least one extension to a Rocket.Chat user. When that user logs in to Rocket.Chat the webphone will try to connect to Asterisk."}),"\n",(0,t.jsx)(n.h3,{id:"31-test-websocket-connection-",children:"3.1 Test WebSocket Connection "}),"\n",(0,t.jsx)(n.p,{children:"To test the WebSocket Connection, you just need to log in with a user associated with an extension and check if the extension registers successfully. "}),"\n",(0,t.jsx)(n.p,{children:"![WebSocket not connected](/img/image (517).png)"}),"\n",(0,t.jsx)(n.p,{children:"The phone icon with a slash over means that the WebSocket connection is possible, Rocket.Chat could send a SIP Options packet to Asterisk, and it was successfully answered. Click on the phone icon, and it will turn green. Now the user is ready to receive calls, and in Asterisk, you should have received a SIP register packet, and the extension should be properly registered. Validate it with:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"pjsip show endpoints"})}),"\n",(0,t.jsxs)("figure",{children:[(0,t.jsx)("img",{src:"/png/image (89).png",alt:""}),(0,t.jsx)("figcaption",{children:(0,t.jsx)("p",{children:"Rocket.Chat configured with Asterisk"})})]}),"\n",(0,t.jsx)(n.p,{children:"Congratulations! You have successfully configured Rocket.Chat with Asterisk!"}),"\n",(0,t.jsxs)(n.p,{children:["The next step now is to ",(0,t.jsx)(n.a,{href:"/docs-exp/docs/use-rocket.chat/rocket.chat-voice-channel/voice-channel-admin-guide/configure-with-an-active-pbx-server/associate-agents-with-extensions-in-rocket.chat",children:"associate your Rocket.Chat agents with Asterisk extensions."}),"\\"]})]})}function d(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>r});var t=i(96540);const c={},s=t.createContext(c);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);