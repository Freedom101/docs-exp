"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[82830],{92271:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var o=n(74848),r=n(28453);const s={},i="Azure Alerts",a={id:"use-rocket.chat/workspace-administration/integrations/azure-alerts",title:"Azure Alerts",description:"Add Azure Alert notifications via a new WebHook in Rocket.Chat",source:"@site/docs/use-rocket.chat/workspace-administration/integrations/azure-alerts.md",sourceDirName:"use-rocket.chat/workspace-administration/integrations",slug:"/use-rocket.chat/workspace-administration/integrations/azure-alerts",permalink:"/docs-exp/docs/use-rocket.chat/workspace-administration/integrations/azure-alerts",draft:!1,unlisted:!1,editUrl:"https://github.com/Freedom101/docs-exp/tree/main/my-website/docs/use-rocket.chat/workspace-administration/integrations/azure-alerts.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"AppVeyor",permalink:"/docs-exp/docs/use-rocket.chat/workspace-administration/integrations/appveyor"},next:{title:"BitRocket",permalink:"/docs-exp/docs/use-rocket.chat/workspace-administration/integrations/bitrocket"}},c={},l=[];function u(e){const t={a:"a",code:"code",em:"em",h1:"h1",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"azure-alerts",children:"Azure Alerts"}),"\n",(0,o.jsx)(t.p,{children:"Add Azure Alert notifications via a new WebHook in Rocket.Chat"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:'In Rocket.Chat go to "Administration"->"Integrations" and create "New Integration"'}),"\n",(0,o.jsx)(t.li,{children:"Choose Incoming WebHook"}),"\n",(0,o.jsx)(t.li,{children:'Follow all instructions like Enable, give it a name, link to channel etc. Set "Enable Script" to true and enter the javascript in the "Script" box'}),"\n",(0,o.jsxs)(t.li,{children:["Press Save changes and copy the ",(0,o.jsx)(t.em,{children:"Webhook URL"})," (added just below the script box)"]}),"\n",(0,o.jsxs)(t.li,{children:["Go to the azure portal and on the specific resource you want to enable Alerts for follow the steps for enabling Alerts and set the previously copied URL as the webhook URL for the Azure Alert. You can follow the steps shown here: ",(0,o.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-log-webhook",children:"https://docs.microsoft.com/en-us/azure/azure-monitor/alerts/alerts-log-webhook"})]}),"\n"]}),"\n",(0,o.jsx)(t.p,{children:'Paste this in javascript in the "Script" textarea on Rocket.Chat webhook settings'}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:'class Script {\n  process_incoming_request({ request }) {\n    // console is a global helper to improve debug\n    console.log(request.content);\n\n    var alertColor = "warning";\n\n    if(request.content.status === "Resolved"){ alertColor = "good"; }\n    else if (request.content.status === "Activated") { alertColor = "danger"; }\n\n    var condition = request.content.context.condition;\n\n    return {\n      content:{\n       username: "Azure",\n        text: "Azure Alert Notification",\n        attachments: [{\n          title: request.content.context.name,\n          pretext: request.content.context.description,\n          title_link: request.content.context.portalLink,\n          text: condition.failureDetails,\n          color: alertColor,\n          fields: [\n            {\n              title: "Status",\n              value: request.content.status + "   @ " + request.content.context.timestamp\n            },\n            {\n              title: "Condition",\n              value: condition.metricName + ": " + condition.metricValue + " " + condition.metricUnit + " for more than " + condition.windowSize + " min."\n            },\n            {\n              title: "Threshold",\n              value: condition.operator + " " + condition.threshold\n            }\n          ]\n        }]\n       }\n    };\n\n    return {\n       error: {\n         success: false,\n         message: \'Error\'\n       }\n    };\n  }\n}\n'})}),"\n",(0,o.jsx)(t.p,{children:"This example shows basic processing of azure alerts that will give you the necessary information as to what happened and what is the current status, along with a status color to get an idea at a quick glimpse of the message."}),"\n",(0,o.jsx)(t.p,{children:"For newer created alerts the azure webhooks can be process by the following script:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:'class Script {\n    // this script was tested with AzureMonitorMetricAlert version 2.0 and should work for\n    // "conditionType": "MultipleResourceMultipleMetricCriteria"\n    process_incoming_request({ request }) {\n        // console is a global helper to improve debug\n        console.log(JSON.stringify(request.content, null, 4));\n\n        var alertColor = "warning";\n        var condition = request.content.data.context.condition;\n        var conditionFields = [];\n\n        if(request.content.data.status === "Deactivated"){ alertColor = "good"; }\n        else if (request.content.data.status === "Activated") {\n            alertColor = "danger";\n            console.log(condition.allOf);\n            for (const cond of condition.allOf) {\n                console.log(cond);\n                conditionFields.push({\n                    title: "Condition: " + cond.metricName,\n                    value: cond.metricValue + " " + cond.operator + " " + cond.threshold + " ("\n                        + (cond.metricUnit ? cond.metricUnit + ", " : "")\n                        + cond.timeAggregation + ")"\n                        + " for more than " + condition.windowSize,\n                });\n            }\n        }\n\n        return {\n            content:{\n                username: "Azure",\n                text: "Azure Alert Notification",\n                attachments: [{\n                    title: request.content.data.context.name,\n                    pretext: request.content.data.context.description,\n                    title_link: request.content.data.context.portalLink,\n                    text: request.content.data.context.resourceGroupName + ": " + request.content.data.context.resourceName,\n                    color: alertColor,\n                    fields: [\n                        {\n                            title: "Status",\n                            value: request.content.data.status + "   @ " + request.content.data.context.timestamp\n                        },\n                        {\n                            title: "Severity",\n                            value: request.content.data.context.severity,\n                        },\n                        ...conditionFields,\n                    ]\n                }]\n            }\n        };\n    }\n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["The schema of the incoming message as of the official ",(0,o.jsx)(t.a,{href:"https://azure.microsoft.com/en-us/documentation/articles/insights-webhooks-alerts/",children:"Azure Alert Webhook Docs"})," is:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:'{\n"status": "Activated",\n"context": {\n            "timestamp": "2015-08-14T22:26:41.9975398Z",\n            "id": "/subscriptions/s1/resourceGroups/useast/providers/microsoft.insights/alertrules/ruleName1",\n            "name": "ruleName1",\n            "description": "some description",\n            "conditionType": "Metric",\n            "condition": {\n                        "metricName": "Requests",\n                        "metricUnit": "Count",\n                        "metricValue": "10",\n                        "threshold": "10",\n                        "windowSize": "15",\n                        "timeAggregation": "Average",\n                        "operator": "GreaterThanOrEqual"\n                },\n            "subscriptionId": "s1",\n            "resourceGroupName": "useast",\n            "resourceName": "mysite1",\n            "resourceType": "microsoft.foo/sites",\n            "resourceId": "/subscriptions/s1/resourceGroups/useast/providers/microsoft.foo/sites/mysite1",\n            "resourceRegion": "centralus",\n            "portalLink": "https://portal.azure.com/#resource/subscriptions/s1/resourceGroups/useast/providers/microsoft.foo/sites/mysite1"\n},\n"properties": {\n              "key1": "value1",\n              "key2": "value2"\n              }\n}\n'})})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>a});var o=n(96540);const r={},s=o.createContext(r);function i(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);