"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[92549],{15487:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var o=n(74848),r=n(28453);const s={},i="Setting up Process Managers and Init Systems",a={id:"setup-and-configure/environment-configuration/additional-configurations/setting-up-process-managers-and-init-systems",title:"Setting up Process Managers and Init Systems",description:"PM2",source:"@site/docs/setup-and-configure/environment-configuration/additional-configurations/setting-up-process-managers-and-init-systems.md",sourceDirName:"setup-and-configure/environment-configuration/additional-configurations",slug:"/setup-and-configure/environment-configuration/additional-configurations/setting-up-process-managers-and-init-systems",permalink:"/docs-exp/docs/setup-and-configure/environment-configuration/additional-configurations/setting-up-process-managers-and-init-systems",draft:!1,unlisted:!1,editUrl:"https://github.com/Freedom101/docs-exp/tree/main/my-website/docs/setup-and-configure/environment-configuration/additional-configurations/setting-up-process-managers-and-init-systems.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Setting Up Client SSL Certificate Authentication for Rocket.Chat",permalink:"/docs-exp/docs/setup-and-configure/environment-configuration/additional-configurations/setting-up-client-ssl-certificate-authentication-for-rocket.chat"},next:{title:"Univention Corporate Server (UCS)",permalink:"/docs-exp/docs/setup-and-configure/environment-configuration/additional-configurations/univention-corporate-server-ucs"}},c={},d=[{value:"PM2",id:"pm2",level:2},{value:"Systemd",id:"systemd",level:2},{value:"How to run Rocket.Chat on systemd.",id:"how-to-run-rocketchat-on-systemd",level:3},{value:"Backup",id:"backup",level:3},{value:"Upstart - Ubuntu",id:"upstart---ubuntu",level:2},{value:"Non-Docker-Compose",id:"non-docker-compose",level:3},{value:"Docker-Compose",id:"docker-compose",level:3}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"setting-up-process-managers-and-init-systems",children:"Setting up Process Managers and Init Systems"}),"\n",(0,o.jsx)(t.h2,{id:"pm2",children:"PM2"}),"\n",(0,o.jsx)(t.h2,{id:"systemd",children:"Systemd"}),"\n",(0,o.jsxs)(t.p,{children:["Deploy ",(0,o.jsx)(t.a,{href:"https://github.com/RocketChat/Rocket.Chat",children:"Rocket.Chat"})," to Linux that run on systemd (RedHat, Centos, Ubuntu, CoreOS and so on)."]}),"\n",(0,o.jsx)(t.h3,{id:"how-to-run-rocketchat-on-systemd",children:"How to run Rocket.Chat on systemd."}),"\n",(0,o.jsx)(t.p,{children:"First we need to create the unit file."}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.code,{children:"vi /etc/systemd/system/rocketchat.service"})}),"\n",(0,o.jsx)(t.p,{children:"With the contents:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"[Unit]\nDescription=Rocket.Chat Server\nAfter=network.target remote-fs.target nss-lookup.target mongod.target nginx.target  # Remove or Replace nginx with your proxy\n\n[Service]\nExecStart=/usr/local/bin/node /var/www/rocketchat/main.js    # Specify the location of node and location of main.js\nRestart=always                                               # If set to always, the service will be restarted regardless of whether it exited cleanly or not, got terminated abnormally by a signal, or hit a timeout.\nRestartSec=10                                                # Restart service after 10 seconds if node service crashes\nStandardOutput=syslog                                        # Output to syslog\nStandardError=syslog                                         # Output to syslog\nSyslogIdentifier=nodejs-example\n#User=<alternate user>\n#Group=<alternate group>\nEnvironment=NODE_ENV=production PORT=3000 ROOT_URL=https://rocketchat.domain.com MONGO_URL=mongodb://localhost:27017/rocketchat\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Then you need to enable the service ",(0,o.jsx)(t.code,{children:"systemctl enable rocketchat.service"})]}),"\n",(0,o.jsxs)(t.p,{children:["To start the service ",(0,o.jsx)(t.code,{children:"systemctl start rocketchat.service"})]}),"\n",(0,o.jsxs)(t.p,{children:["To verify it is running ",(0,o.jsx)(t.code,{children:"systemctl status rocketchat.service"})]}),"\n",(0,o.jsx)(t.h3,{id:"backup",children:"Backup"}),"\n",(0,o.jsxs)(t.p,{children:["All data will be hourly backed up to ",(0,o.jsx)(t.code,{children:"/data/domains/example.org/data"})," folder. We advise to copy this folder to a remote location in case of hardware failure."]}),"\n",(0,o.jsx)(t.h2,{id:"upstart---ubuntu",children:"Upstart - Ubuntu"}),"\n",(0,o.jsx)(t.p,{children:(0,o.jsx)(t.strong,{children:"Note: Upstart is no longer supported. We no longer support Ubuntu 14.04. If upgrading please see systemd or Ubuntu 18.04"})}),"\n",(0,o.jsx)(t.p,{children:"The following examples are upstart jobs which control automatic start-up and, if necessary, respawning of your Rocket.Chat app, as well as management of an optional hubot chat-bot."}),"\n",(0,o.jsx)(t.p,{children:"In order to use the examples, simply copy each example and save into a file, paying attention to the fact that the filenames should be preserved unless you edit the examples to reflect any filename changes you make. Be sure to edit the environment variables, and possibly paths, according to your particular installation. Once you've saved the files to the proper directory (/etc/init) usage is as simple as rebooting."}),"\n",(0,o.jsx)(t.p,{children:"Which upstart management jobs that you use depend on what type of Rocket.Chat deployment you are using (Docker-compose, non-docker, etc). A race-condition exists with docker compose which requires that mongo and the Rocket.Chat application be started independently, thus a slightly modified upstart job is required compared to non-docker instances."}),"\n",(0,o.jsx)(t.h3,{id:"non-docker-compose",children:"Non-Docker-Compose"}),"\n",(0,o.jsxs)(t.p,{children:["Save as: ",(0,o.jsx)(t.code,{children:"/etc/init/rocketchat.conf"})]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'description "rocketchat application server"\n\n# Wait for mongod before starting rocketchat app\nstart on (started mongod)\nstop on runlevel [!2345]\n\n# Automatically attempt to restart with finite limits\nrespawn\nrespawn limit 99 5\n\n# Export necessary variables and start the Applications / Services\nscript\n    export MONGO_URL=mongodb://localhost:27017/rocketchat\n    export ROOT_URL=https://host.yourdomain.tld\n    export PORT=3000\n    exec /usr/local/bin/node /home/administrator/Rocket.Chat/main.js\nend script\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Save as: ",(0,o.jsx)(t.code,{children:"/etc/init/rocketchat_hubot.conf"})]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'description "hubot launcher"\n\n# Wait for the rocketchat upstart job before starting hubot\nstart on started rocketchat\nstop on runlevel [!2345]\n\n# Automatically Respawn with finite limits\nrespawn\nrespawn limit 99 5\n\nscript\n    # Wait until Rocket.Chat is up and listening to port tcp 3000\n    until nc -z localhost 3000; do\n        sleep 1\n    done\n\n    # Export necessary variables\n    export ROCKETCHAT_ROOM=GENERAL\n    export ROCKETCHAT_USER=bot_username\n    export ROCKETCHAT_PASSWORD=bot_password\n\n    # Change to the hubot directory\n    cd /home/administrator/myhubot\n\n    # Launch Hubot\n    exec bin/hubot -a rocketchat\nend script\n'})}),"\n",(0,o.jsx)(t.h3,{id:"docker-compose",children:"Docker-Compose"}),"\n",(0,o.jsxs)(t.p,{children:["Save as: ",(0,o.jsx)(t.code,{children:"/etc/init/rocketchat_mongo.conf"})]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'description "MongoDB service manager for rocketchat"\n\n# Start MongoDB after docker is running\nstart on (started docker)\nstop on runlevel [!2345]\n\n# Automatically Respawn with finite limits\nrespawn\nrespawn limit 99 5\n\n# Path to our app\nchdir /var/www/rocket.chat\n\nscript\n    # start mongoDB\n    exec /usr/local/bin/docker compose up db\nend script\n'})}),"\n",(0,o.jsxs)(t.p,{children:["Save as: ",(0,o.jsx)(t.code,{children:"/etc/init/rocketchat_app.conf"})]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'description "Rocket.Chat service manager"\n\n# Start Rocket.Chat after mongo upstart job is running\nstart on (started rocketchat_mongo)\nstop on runlevel [!2345]\n\n# Automatically Respawn with finite limits\nrespawn\nrespawn limit 99 5\n\n# Path to our app\nchdir /var/www/rocket.chat\n\nscript\n    # Bring up rocketchat app and hubot\n    exec /usr/local/bin/docker compose up rocketchat hubot\nend script\n'})})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>a});var o=n(96540);const r={},s=o.createContext(r);function i(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);